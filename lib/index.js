// Generated by CoffeeScript 1.4.0
var get, set;

get = Em.get;

set = Em.set;

module.exports = Em.Mixin.create({
  init: function() {
    /*
          if isInline,
          make view as contenteditable,
          else make view as textarea
    */

    var isInline, properties;
    isInline = get(this, "isInline");
    if (isInline === true) {
      properties = {
        attributeBindings: ["contenteditable"],
        contenteditable: "true"
      };
    } else {
      properties = {
        tagName: "textarea",
        classNames: ["ckeditor"],
        attributeBindings: ["name"],
        nameBinding: "elementId"
      };
    }
    this.setProperties(properties);
    return this._super();
  },
  template: Em.Handlebars.compile(""),
  didInsertElement: function() {
    var abspath, content, editor, elementId, isInline, lastSlash, path, that, updateViewContent;
    this._super();
    path = document.location.pathname;
    lastSlash = path.lastIndexOf("/") + 1;
    abspath = path.substring(0, lastSlash);
    window.CKEDITOR_BASEPATH = "" + abspath + "build/kelonye-ember-ckedit/ckeditor/";
    require("../ckeditor/ckeditor");
    that = this;
    isInline = get(this, "isInline");
    elementId = get(that, "elementId");
    if (isInline === true) {
      CKEDITOR.disableAutoInline = true;
      editor = CKEDITOR.inline(elementId);
    } else {
      editor = CKEDITOR.replace(elementId);
    }
    content = get(that, "content");
    editor.setData(content);
    set(that, "editor", editor);
    updateViewContent = function() {
      editor = get(that, "editor");
      content = editor.getData();
      return set(that, "content", content);
    };
    editor.on("focus", function() {
      return updateViewContent();
    });
    editor.on("blur", function() {
      return updateViewContent();
    });
    return editor.on("key", function() {
      return updateViewContent();
    });
  },
  willDestroyElement: function() {
    var editor;
    editor = get(this, "editor");
    return editor != null ? editor.destroy(true) : void 0;
  }
});
